<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ranjit Game of Game</title>
<style>
body { margin: 0; overflow: hidden; font-family: Arial; }
canvas { display: block; }
#ui {
  position: absolute;
  top: 10px; left: 10px;
  color: white;
  background: rgba(0,0,0,0.6);
  padding: 10px;
  border-radius: 8px;
  font-size: 16px;
}
#title {
  position: absolute;
  top: 10px; right: 10px;
  color: yellow;
  font-weight: bold;
  font-size: 20px;
  background: rgba(0,0,0,0.5);
  padding: 5px 10px;
  border-radius: 8px;
}
</style>
</head>
<body>
<div id="title">Ranjit Game of Game</div>
<div id="ui">
  Loop iteration: <span id="loopCount">0</span><br>
  Mission Progress: <span id="missionStatus">Collect all green items!</span>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>

<script>
// --- Scene Setup ---
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

// Camera
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);

// Renderer
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Floor
const floorGeo = new THREE.PlaneGeometry(400,400);
const floorMat = new THREE.MeshStandardMaterial({color:0x333333});
const floor = new THREE.Mesh(floorGeo,floorMat);
floor.rotation.x = -Math.PI/2;
scene.add(floor);

// Buildings Grid
for(let i=-80;i<=80;i+=20){
  for(let j=-80;j<=80;j+=20){
    const boxGeo = new THREE.BoxGeometry(10, Math.random()*10+5, 10);
    const boxMat = new THREE.MeshStandardMaterial({color:0x555555});
    const building = new THREE.Mesh(boxGeo, boxMat);
    building.position.set(i, boxGeo.parameters.height/2, j);
    scene.add(building);
  }
}

// Lighting
scene.add(new THREE.AmbientLight(0xffffff,0.5));
const dirLight = new THREE.DirectionalLight(0xffffff,0.8);
dirLight.position.set(50,50,50);
scene.add(dirLight);

// --- Player Car ---
const carGeo = new THREE.BoxGeometry(2,1,4);
const carMat = new THREE.MeshStandardMaterial({color:0xff0000});
const car = new THREE.Mesh(carGeo,carMat);
car.position.set(0,0.5,0);
scene.add(car);

// --- Mission Items ---
const missionItems = [];
for(let i=0;i<5;i++){
  const itemGeo = new THREE.CylinderGeometry(1,1,0.2,32);
  const itemMat = new THREE.MeshStandardMaterial({color:0x00ff00});
  const item = new THREE.Mesh(itemGeo,itemMat);
  item.position.set((Math.random()*140-70),0.1,(Math.random()*140-70));
  scene.add(item);
  missionItems.push(item);
}

// --- NPC Enemies ---
const npcs = [];
for(let i=0;i<3;i++){
  const npcGeo = new THREE.BoxGeometry(2,1,2);
  const npcMat = new THREE.MeshStandardMaterial({color:0x0000ff});
  const npc = new THREE.Mesh(npcGeo,npcMat);
  npc.position.set(Math.random()*140-70,0.5,Math.random()*140-70);
  scene.add(npc);
  npcs.push(npc);
}

// --- Controls ---
let moveForward=false, moveBackward=false, moveLeft=false, moveRight=false;
const speed=0.5;
document.addEventListener('keydown', e=>{
  if(e.code==='KeyW') moveForward=true;
  if(e.code==='KeyS') moveBackward=true;
  if(e.code==='KeyA') moveLeft=true;
  if(e.code==='KeyD') moveRight=true;
});
document.addEventListener('keyup', e=>{
  if(e.code==='KeyW') moveForward=false;
  if(e.code==='KeyS') moveBackward=false;
  if(e.code==='KeyA') moveLeft=false;
  if(e.code==='KeyD') moveRight=false;
});

// --- Time Loop ---
let loopIteration=0;
const loopTime = 30000; // 30 sec
let loopTimer;

function startLoop(){
  loopIteration++;
  document.getElementById('loopCount').textContent = loopIteration;
  car.position.set(0,0.5,0);
  missionItems.forEach(item=>item.visible=true);
  document.getElementById('missionStatus').textContent = "Collect all green items!";
  loopTimer = setTimeout(startLoop, loopTime);
}
startLoop();

// --- Animate ---
function animate(){
  requestAnimationFrame(animate);

  // Move car
  if(moveForward) car.position.z -= speed;
  if(moveBackward) car.position.z += speed;
  if(moveLeft) car.position.x -= speed;
  if(moveRight) car.position.x += speed;

  // Camera follows car
  camera.position.set(car.position.x, car.position.y+5, car.position.z+10);
  camera.lookAt(car.position);

  // NPC simple patrol
  npcs.forEach((npc,i)=>{
    npc.position.x += Math.sin(Date.now()*0.001+i)*0.02;
    npc.position.z += Math.cos(Date.now()*0.001+i)*0.02;
    // Collision with car
    if(car.position.distanceTo(npc.position)<2){
      document.getElementById('missionStatus').textContent = "ðŸ’¥ Hit NPC! Loop resets!";
      clearTimeout(loopTimer);
      startLoop();
    }
  });

  // Mission collection
  let collected = 0;
  missionItems.forEach(item=>{
    if(item.visible && car.position.distanceTo(item.position)<2){
      item.visible=false;
      collected++;
    }
  });

  if(collected === missionItems.length){
    document.getElementById('missionStatus').textContent = "ðŸŽ‰ All items collected! Loop stopped!";
    clearTimeout(loopTimer);
  }

  renderer.render(scene,camera);
}

animate();

// --- Window Resize ---
window.addEventListener('resize', ()=>{
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
